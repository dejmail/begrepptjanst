{% extends 'term.html' %}
{% load crispy_forms_filters %}

{% block content %}
{% block mitten-span %}
{{ block.super }}

{% if begrepp_full %}
<div id="förklaring" class="förklaring">

<div class="searchTable">

<table id="term_förklaring_tabell" class="table table-bordered">
    <tbody>
        <tr class="{{färg_status.begrepp}}">
            <td>Status</td>
            <td>{{begrepp_full.status}}</td>
        </tr>

        <tr class="{{färg_status.begrepp}}">
            <td>Term</td>
            {% if begrepp_full.status == "Avråds" %}
                <td><s class="text-danger">{{begrepp_full.term}}</s></td>
            {% else %}
                <td>{{begrepp_full.term}}</td>
            {% endif %}
        </tr>
        <tr>
            <td>Synonym</td>
            <td>    
                    {% for list_item in synonym_full %}
                        {% if list_item.synonym is not None %}
                            {% if list_item.synonym_status == "Avråds" %}
                            - <button type="button" class="btn-sm btn-avrådd"><s>{{list_item.synonym}}</s></button>
                            <br>
                            {% else %}
                                - {{list_item.synonym}}<br>
                            {% endif %}                            
                        {% else %}
                            -
                        {% endif %}
                    {% endfor %}
            </td>        
        </tr>

        <tr class="{{färg_status.begrepp}}">
            <td>Definition</td>
            {% if begrepp_full.status == "Avråds" %}
                <td><s class="text-danger">{{begrepp_full.definition}}</s></td>
            {% else %}
                <td>{{begrepp_full.definition}}</td>
            {% endif %}
        </tr>
        <tr class="{{färg_status.begrepp}}">
            <td>Anmärkning</td>
            {% if begrepp_full.status == "Avråds" %}
                <td><s class="text-danger">{{begrepp_full.anmärkningar|default_if_none:'-'}}</s></td>
            {% else %}
                <td>{{begrepp_full.anmärkningar|default_if_none:'-'}}</td>
            {% endif %}
        </tr>  
        <tr class="{{färg_status.begrepp}}">
            <td>Term på annat språk</td>
            <td>{{begrepp_full.utländsk_term}}</td>
        </tr>
        <tr>
            <td>Definition på annat språk</td>
            <td>{{begrepp_full.utländsk_definition}}</td>
        </tr>
        <tr>
            <td>Kontext beskrivning</td>
            <td>{{begrepp_full.begrepp_kontext | urlize }}</td>
        </tr>
        <tr>
            <td>ID VGR</td>
            <td>{{begrepp_full.id_vgr}}</td>
        </tr>
        <tr>
            <td>Annan ordlista</td>
            <td>{{begrepp_full.annan_ordlista}}</td>
        </tr>
        <tr>
            <td>Kod</td>
            <td>{{begrepp_full.externt_id}}</td>
        </tr>
        <tr>
            <td>Verifierad användning</td>
            
            <td>{% for domän in domän_full %}
                - {{domän.domän_namn}}<br>
                {% endfor %}
            </td>
        </tr>

        <tr>
            <td><button id="opponera_button">Kommentera</button></td>
            <td><button id="bekräfta_button">Verifiera användning</button></td>
        </tr>
    </tbody>
</table> 
</div>

{% else %}
        <p>Ingen definition hittades...</p>
{% endif %}

</div>

<div id="opponera_bekräfta">

</div>
{% endblock mitten-span %}
{% endblock content %}

{% block extra_javascript %}
<script>

var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
// create an observer instance
var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'childList') {
            scrollSmoothToBottom();
            if ($('input[name=namn]').length > 0) {
                $('input[name=namn]').focus();
            } else {
                $('input[name=epost]').focus();
            }
    }
    });
});
 
// configuration of the observer:
var config = {childList: true}
 
var target = document.querySelector('#opponera_bekräfta');
// pass in the target node, as well as the observer options
observer.observe(target, config);
 

function get_form_function(url, div_to_replace, type_method){
        
        $.ajax({
            url : url,
            type : type_method,
            success: function(response){
                $(div_to_replace).html(response);
                history.pushState(url, '',url)
            }
        });

    }
    
$(document).ready(function(){



    $("#opponera_button").click(function(){
        get_form_function(url="{% url 'opponera_term' %}?q={{begrepp_full.term}}", 
                          div_to_replace="#opponera_bekräfta",
                          type_method="GET");
                        });
                          
    $("#bekräfta_button").click(function(){    
    
        get_form_function(url="{% url 'bekräfta_term' %}?q={{begrepp_full.term}}",
                          div_to_replace="#opponera_bekräfta",
                          type_method="GET"); 
                        });
    });

function scrollSmoothToBottom() {
    var div = document.getElementById("opponera_bekräfta");
    div.scrollIntoView({behavior : 'smooth'});
};


</script>

{% endblock %}